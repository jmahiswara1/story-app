<!DOCTYPE html>
<html>
  <head>
    <title>API Debugger</title>
    <style>
      body {
        font-family: monospace;
        max-width: 1200px;
        margin: 20px auto;
        background: #1a1a1a;
        color: #e0e0e0;
        padding: 20px;
      }
      .section {
        background: #2a2a2a;
        border-left: 4px solid #6ab0ff;
        padding: 20px;
        margin: 20px 0;
        border-radius: 4px;
      }
      h2 {
        color: #6ab0ff;
        margin-top: 0;
      }
      input,
      button {
        padding: 8px;
        margin: 5px;
        background: #333;
        color: #e0e0e0;
        border: 1px solid #555;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #444;
      }
      pre {
        background: #1a1a1a;
        border: 1px solid #444;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
      }
      .success {
        color: #2ecc71;
      }
      .error {
        color: #ff6b6b;
      }
      .info {
        color: #6ab0ff;
      }
    </style>
  </head>
  <body>
    <h1>Story API Debugger</h1>

    <div class="section">
      <h2>1. Test API Access</h2>
      <div>
        <label>Token (optional):</label>
        <input type="text" id="token" placeholder="Paste your JWT token here" />
      </div>
      <button onclick="testGetStories()">Test GET /stories</button>
      <button onclick="testStoreToken()">Save Token to LocalStorage</button>
      <pre id="output-stories"></pre>
    </div>

    <div class="section">
      <h2>2. Check LocalStorage</h2>
      <button onclick="checkStorage()">Show Storage Contents</button>
      <pre id="output-storage"></pre>
    </div>

    <div class="section">
      <h2>3. Test Parameters</h2>
      <div>
        <label>Page:</label>
        <input type="number" id="page" value="1" />
        <label>Size:</label>
        <input type="number" id="size" value="50" />
        <label>Location:</label>
        <input type="number" id="location" value="1" />
      </div>
      <button onclick="testWithParams()">Test with Custom Params</button>
      <pre id="output-params"></pre>
    </div>

    <div class="section">
      <h2>4. API Info</h2>
      <pre>
BASE_URL: https://story-api.dicoding.dev/v1

Endpoint: GET /stories
Query Params:
  - page (number): 1-based page number
  - size (number): Items per page (max 50)
  - location (number): Include location data (0 or 1)

Headers Required:
  - Authorization: Bearer {token}
  - Content-Type: application/json

Expected Response (200):
  {
    "error": false,
    "message": "Stories fetched successfully",
    "listStory": [
      {
        "id": "string",
        "name": "string",
        "description": "string",
        "photoUrl": "string",
        "createdAt": "ISO 8601 timestamp",
        "lat": number or null,
        "lon": number or null
      }
    ]
  }

Common Errors:
  - 401: Missing/invalid token
  - 405: Wrong method or endpoint doesn't support this method
  - 400: Bad request (invalid parameters)
  - 500: Server error
    </pre
      >
    </div>

    <script>
      const BASE_URL = "https://story-api.dicoding.dev/v1";

      function getToken() {
        const input = document.getElementById("token").value;
        if (input) return input;
        return localStorage.getItem("authToken");
      }

      function log(elementId, title, data, isError = false) {
        const el = document.getElementById(elementId);
        const timestamp = new Date().toLocaleTimeString();
        const className = isError ? "error" : "info";
        el.innerHTML = `<span class="${className}">[${timestamp}] ${title}</span>\n${
          typeof data === "string" ? data : JSON.stringify(data, null, 2)
        }`;
      }

      async function testGetStories() {
        const token = getToken();
        if (!token) {
          log(
            "output-stories",
            "ERROR",
            "No token found. Paste token in input or login first.",
            true
          );
          return;
        }

        try {
          const url = `${BASE_URL}/stories?page=1&size=50&location=1`;
          const res = await fetch(url, {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          const data = await res.json();

          log(
            "output-stories",
            `GET ${url} → ${res.status}`,
            {
              status: res.status,
              statusText: res.statusText,
              headers: Object.fromEntries(res.headers),
              data: data,
            },
            !res.ok
          );
        } catch (err) {
          log(
            "output-stories",
            "FETCH ERROR",
            {
              message: err.message,
              stack: err.stack,
            },
            true
          );
        }
      }

      async function testWithParams() {
        const token = getToken();
        if (!token) {
          log("output-params", "ERROR", "No token found.", true);
          return;
        }

        const page = document.getElementById("page").value;
        const size = document.getElementById("size").value;
        const location = document.getElementById("location").value;

        try {
          const url = `${BASE_URL}/stories?page=${page}&size=${size}&location=${location}`;
          const res = await fetch(url, {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          const data = await res.json();

          log(
            "output-params",
            `GET /stories (page=${page}, size=${size}, location=${location}) → ${res.status}`,
            {
              status: res.status,
              itemCount: data.listStory?.length || 0,
              data: data,
            },
            !res.ok
          );
        } catch (err) {
          log("output-params", "FETCH ERROR", err.message, true);
        }
      }

      function storeToken() {
        const token = document.getElementById("token").value;
        if (!token) {
          log("output-stories", "ERROR", "Please paste a token first", true);
          return;
        }
        localStorage.setItem("authToken", token);
        log("output-stories", "SUCCESS", "Token saved to localStorage", false);
      }

      function checkStorage() {
        const storage = {
          authToken: localStorage.getItem("authToken"),
          userName: localStorage.getItem("userName"),
          allKeys: Object.keys(localStorage),
        };
        log("output-storage", "LocalStorage Contents", storage);
      }

      function testStoreToken() {
        storeToken();
      }
    </script>
  </body>
</html>
